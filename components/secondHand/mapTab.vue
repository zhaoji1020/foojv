<template>    <div class="clearfix map-container">        <h2 class="map-title">周边配套</h2>        <div class="map-content clearfix">            <div class="map-list fll">                <div id="allmap" class="map-item" ></div>            </div>            <div class="wrap clearfix flr">                <el-tabs v-model="mapObj.searchText" type="card" class="map-tab flr">                    <el-tab-pane label="交通" name="交通">                        <div>                            两公里以内的交通设施                        </div>                        <ul v-if="mapObj.searchArr.length>0" class="search-lists">                            <li v-for="(item,index) in mapObj.searchArr" :class="{active: (mapObj.selectIndex ==index && searchText=='交通')}">{{item.title}}</li>                        </ul>                        <div v-else>暂无数据</div>                    </el-tab-pane>                    <el-tab-pane label="商业" name="商业">                        <div>                            两公里以内的商业设施                        </div>                        <ul v-if="mapObj.searchArr.length>0" class="search-lists">                            <li v-for="(item,index) in mapObj.searchArr" :class="{active: mapObj.selectIndex ==index && searchText=='商业'}">{{item.title}}</li>                        </ul>                        <div v-else>暂无数据</div>                    </el-tab-pane>                    <el-tab-pane label="教育" name="教育">                        <div>                            两公里以内的教育设施                        </div>                        <ul v-if="mapObj.searchArr.length>0" class="search-lists">                            <li v-for="(item,index) in mapObj.searchArr" :class="{active: mapObj.selectIndex ==index && searchText=='教育'}">{{item.title}}</li>                        </ul>                        <div v-else>暂无数据</div>                    </el-tab-pane>                    <el-tab-pane label="医院" name="医院">                        <div>                            两公里以内的医院设施                        </div>                        <ul v-if="mapObj.searchArr.length>0" class="search-lists">                            <li v-for="(item,index) in mapObj.searchArr" :class="{active: mapObj.selectIndex ==index && searchText=='医院'}">{{item.title}}</li>                        </ul>                        <div v-else>暂无数据</div>                    </el-tab-pane>                </el-tabs>            </div>        </div>    </div></template><script>    export default {        props: {            log: {                type: [Number,String]  //通过传值接受经纬度，方便组件复用            },            lat: {                type: [Number,String]            }        },        data() {            return {                activeName: "1",                mapObj: {                    map: null,                    point: null,                    local: null,                    searchArr: [],                    searchText: "交通",                    selectIndex: -1                }            }        },        methods: {            loadScript() {                if (document.getElementById("fooju-map")) {this.initMap();return}//异步加载地图api，如果script存在，则跳出该函数                window.initMap = this.initMap; //异步加载的时候，window对象上的该函数将被自动运行。                let script = document.createElement("script");                script.src = "http://api.map.baidu.com/api?v=2.0&ak=T8aGZOH2GC1ypqIbi7ZZ35NeO0AR4tgl&callback=initMap"; //将地图的SDK添加到页面当中去。                script.id = "fooju-map"; //给地图添加唯一id，防止重复添加SDK                document.body.appendChild(script);            },            initMap() {                this.$nextTick(() => {                    //定义地图经纬度变量(当获取不到数据的时候采用默认值)                    let log = 111.65;                    let lat = 40.82                    if(this.log&&this.lat){                        log = this.log;                        lat = this.lat;                    }                    this.mapObj.map = new BMap.Map("allmap");  //设置地图对象                    this.mapObj.point = new BMap.Point(log, lat);  // 创建点坐标                    this.mapObj.map.centerAndZoom(this.mapObj.point, 15); // 初始化地图，设置中心点坐标和地图级别                    this.mapObj.map.enableScrollWheelZoom(true); //地图支持缩放                    //创建地图对象完成，利用searchMap函数去执行周边搜索                    this.searchMap();                })            },            searchMap() {                let mapObj = this.mapObj;                let _this = this;                _this.mapObj.searchArr = [];//搜索服务前清空数组                _this.mapObj.selectIndex = -1;                // 定义搜索设置                mapObj.options  = {                    renderOptions: {                        autoViewport: true                    },                    onSearchComplete: function(results){                        if (mapObj.local.getStatus() == BMAP_STATUS_SUCCESS){                            // 判断状态是否正确                            _this.mapObj.searchArr = [];                            for (var i = 0; i < results.getCurrentNumPois(); i ++){                                let searchPoint = results.getPoi(i).point; //搜索出来的点的坐标                                let distance = _this.mapObj.map.getDistance(_this.mapObj.map.point, searchPoint) //通过两点计算距离                                let searchObj = {                                    ...results.getPoi(i),                                    distance                                }//得到搜索出来的周边对象。                                // 给周边服务的点创建icon标识                                let searchIcon = new BMap.Icon(_this.computedIconUrl, new BMap.Size(46, 38));                                //给地图对象创建一个标注                                let imgMarker = new BMap.Marker(searchPoint, {                                    icon: searchIcon                                });                                //将标注添加到地图上                                _this.mapObj.map.addOverlay(imgMarker);                                _this.mapObj.searchArr.push(searchObj);//将搜索的数据存储                                //给标注添加说明窗口                                _this.addIconLabel(imgMarker, searchObj.title, i, searchPoint)                            }                        }                    }                }                if(!this.log&&!this.lat) {return}//如果没有传入坐标值，则不执行周边搜索，仅设置默认地图                //搜索周边并按照传入的mapObj.options进行查找                this.mapObj.local = new BMap.LocalSearch(this.mapObj.map, mapObj.options);                //搜索中心点一公里的医院。                this.mapObj.local.searchNearby(this.mapObj.searchText, mapObj.point, 1000);                // 绘制一个圆形区域                this.mapObj.circle = new BMap.Circle(this.mapObj.point, 1000, {                    fillColor: "blue",  //填充颜色                    strokeWeight: 1,   //圆形边线的宽度，以像素为单位                    fillOpacity: 0.3, //形填充的透明度，取值范围0 - 1                    strokeOpacity: 0.3 //圆形边线透明度，取值范围0 - 1                });                this.mapObj.map.addOverlay(this.mapObj.circle); //将圆形区域绘制到地图上            },            //添加说明窗体函数            addIconLabel(imgMarker,address,index,searchPoint) {                let _this = this;                let options = {                    width: 250, // 信息窗口宽度                    height: 80, // 信息窗口高度                    title: "信息窗口", // 信息窗口标题                    enableMessage: true //设置允许信息窗发送短息                };                imgMarker.addEventListener("click",function() {                    _this.mapObj.selectIndex = index;  //切换选择的index。控制样式绑定，切换右边窗口的高亮                    let infoWindow = new BMap.InfoWindow(address, options); // 创建信息窗口对象                    _this.mapObj.map.openInfoWindow(infoWindow, searchPoint); //开启信息窗口                })            }        },        mounted() {            this.loadScript();  //执行异步加载地图        },        watch: {            searchText(val) {  //当选项卡的选择变化的时候，重新执行地图初始化                this.initMap();                this.searchMap();            }        },        computed: {            searchText() {                return this.mapObj.searchText; //返回搜索的文字            },            computedIconUrl() {//根据选择的选项卡，返回不同的图标图片                if(this.searchText == "交通"){                    return 'http://www.fooju.cn/img/gongjiao.png'                }                else if(this.searchText == "商业") {                    return 'http://www.fooju.cn/img/yinhang.png'                }                else if(this.searchText == "教育") {                    return 'http://www.fooju.cn/img/jiaoyu.png'                }                else {                    return 'http://www.fooju.cn/img/yiyuan.png'                }            }        }    }</script><style scoped lang="scss">    .map-title {        font-size: 30px;        color: #333;        font-weight: lighter;    }    .map-container {        width: 1100px;        margin: 40px auto 0;        .map-content {            box-sizing: border-box;            border: 1px solid #ccc;            padding: 14px 0 14px 14px;            margin-top: 40px;        }    }    .map-tab {        width: 481px;    }    .map-item {        width: 578px;        height: 400px;    }    .search-lists .active{        color: #f00;    }</style>